#

---
title: "Design of the DEFUSE3 Trial"
author: "Tze Leung Lai, Philip W. Lavori, Olivia Liao, Ka Wai Tsang
and Balasubramanian Narasimhan"
date: '`r Sys.Date()`'
bibliography: assistant.bib
output:
  html_document:
  theme: cerulean
  toc: yes
  toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Design of the DEFUSE3 Trial}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r echo=F}
### get knitr just the way we like it

knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  error = FALSE,
  tidy = FALSE,
  cache = FALSE
)
```

## Introduction

Here, we present the calculations for the initial design of the
DEFUSE3 trial based on [@Lai2014191] and [@Lai201593]. The trial
parameters are fixed as follows.


```{r}
library(ASSISTant)
##Fix randomization vector N, errors, eps
trialParameters <- list(N = c(200, 340, 476), type1Error = 0.025,
                        eps = 1/2, type2Error = 0.1)

null.uniform <- rep(1, 7L) ## uniform on 7 support points
hourglass <- c(1, 2, 2, 1, 2, 2, 1)
inverted.hourglass <- c(2, 1, 1, 2, 1, 1, 2)
bottom.heavy <- c(2, 2, 2, 1, 1, 1, 1)
bottom.heavier <- c(3, 3, 2, 2, 1, 1, 1)
top.heavy <- c(1, 1, 1, 1, 2, 2, 2)
top.heavier <- c(1, 1, 1, 2, 2, 3, 3)
ctlDist <- null.uniform
trtDist <- cbind(null.uniform, null.uniform, null.uniform,
                 hourglass, hourglass, hourglass)

```

The design parameters are the following for various scenarios.

```{r}
designParameters <- list(
    nul0 = list(prevalence = rep(1/6, 6),
                ctlDist = ctlDist,
                trtDist = cbind(null.uniform, null.uniform, null.uniform,
                                null.uniform, null.uniform, null.uniform)),
    alt1 = list(prevalence = rep(1/6, 6),
                ctlDist = ctlDist,                
                trtDist = cbind(null.uniform, null.uniform, null.uniform,
                                hourglass, hourglass, hourglass)),
    alt2 = list(prevalence = rep(1/6, 6),
                ctlDist = ctlDist,                
                trtDist = cbind(hourglass, hourglass, hourglass,
                                null.uniform, null.uniform, null.uniform)),
    alt3 = list(prevalence = rep(1/6, 6),
                ctlDist = ctlDist,                
                trtDist = cbind(hourglass, hourglass, hourglass,
                                hourglass, hourglass, hourglass)),

    alt4 = list(prevalence = rep(1/6, 6),
                ctlDist = ctlDist,                
                trtDist = cbind(null.uniform, null.uniform, null.uniform,
                                inverted.hourglass, inverted.hourglass, inverted.hourglass)),
    alt5 = list(prevalence = rep(1/6, 6),
                ctlDist = ctlDist,                
                trtDist = cbind(inverted.hourglass, inverted.hourglass, inverted.hourglass,
                                null.uniform, null.uniform, null.uniform)),
    alt6 = list(prevalence = rep(1/6, 6),
                ctlDist = ctlDist,                
                trtDist = cbind(inverted.hourglass, inverted.hourglass, inverted.hourglass,
                                inverted.hourglass, inverted.hourglass, inverted.hourglass)),

    alt7 = list(prevalence = rep(1/6, 6),
                ctlDist = ctlDist,                
                trtDist = cbind(null.uniform, null.uniform, null.uniform,
                                bottom.heavy, bottom.heavy, bottom.heavy)),
    alt8 = list(prevalence = rep(1/6, 6),
                ctlDist = ctlDist,                
                trtDist = cbind(bottom.heavy, bottom.heavy, bottom.heavy,
                                null.uniform, null.uniform, null.uniform)),
    alt9 = list(prevalence = rep(1/6, 6),
                ctlDist = ctlDist,                
                trtDist = cbind(bottom.heavy, bottom.heavy, bottom.heavy,
                                bottom.heavy, bottom.heavy, bottom.heavy)),

    alt10 = list(prevalence = rep(1/6, 6),
                 ctlDist = ctlDist,                
                 trtDist = cbind(null.uniform, null.uniform, null.uniform,
                                 bottom.heavier, bottom.heavier, bottom.heavier)),
    alt11 = list(prevalence = rep(1/6, 6),
                 ctlDist = ctlDist,                
                 trtDist = cbind(bottom.heavier, bottom.heavier, bottom.heavier,
                                 null.uniform, null.uniform, null.uniform)),
    alt12 = list(prevalence = rep(1/6, 6),
                 ctlDist = ctlDist,                
                 trtDist = cbind(bottom.heavier, bottom.heavier, bottom.heavier,
                                 bottom.heavier, bottom.heavier, bottom.heavier)),
    
    alt13 = list(prevalence = rep(1/6, 6),
                 ctlDist = ctlDist,                
                 trtDist = cbind(null.uniform, null.uniform, null.uniform,
                                 top.heavy, top.heavy, top.heavy)),
    alt14 = list(prevalence = rep(1/6, 6),
                 ctlDist = ctlDist,                
                 trtDist = cbind(top.heavy, top.heavy, top.heavy,
                                 null.uniform, null.uniform, null.uniform)),
    alt15 = list(prevalence = rep(1/6, 6),
                 ctlDist = ctlDist,                
                 trtDist = cbind(top.heavy, top.heavy, top.heavy,
                                 top.heavy, top.heavy, top.heavy)),

    alt16 = list(prevalence = rep(1/6, 6),
                 ctlDist = ctlDist,                
                 trtDist = cbind(null.uniform, null.uniform, null.uniform,
                                 top.heavier, top.heavier, top.heavier)),
    alt17 = list(prevalence = rep(1/6, 6),
                 ctlDist = ctlDist,                
                 trtDist = cbind(top.heavier, top.heavier, top.heavier,
                                 null.uniform, null.uniform, null.uniform)),
    alt18 = list(prevalence = rep(1/6, 6),
                 ctlDist = ctlDist,                
                 trtDist = cbind(top.heavier, top.heavier, top.heavier,
                                 top.heavier, top.heavier, top.heavier))
)

```

## The NULL Scenario

```{r}
defuse3.null <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$nul0,
                                  showProgress = FALSE)
print(defuse3.null)
```

```{r}
result <- defuse3.null$explore(numberOfSimulations = 25000,
                               rngSeed = 283768,
                               showProgress = FALSE)
analysis <- defuse3.null$analyze(result)
print(defuse3.null$summary(analysis))
```

## The ALT1 Scenario

```{r}
defuse3.alt1 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt1,
                                  showProgress = FALSE)
print(defuse3.alt1)
```

```{r}
result <- defuse3.alt1$explore(numberOfSimulations = 25000,
                               rngSeed = 378932,
                               showProgress = FALSE)
analysis <- defuse3.alt1$analyze(result)
print(defuse3.alt1$summary(analysis))
```

## The ALT2 Scenario

```{r}
defuse3.alt2 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt2,
                                  showProgress = FALSE)
print(defuse3.alt2)
```

```{r}
result <- defuse3.alt2$explore(numberOfSimulations = 25000,
                               rngSeed = 435305,
                               showProgress = FALSE)
analysis <- defuse3.alt2$analyze(result)
print(defuse3.alt2$summary(analysis))
```
## The ALT3 Scenario

```{r}
defuse3.alt3 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt3,
                                  showProgress = FALSE)
print(defuse3.alt3)
```

```{r}
result <- defuse3.alt3$explore(numberOfSimulations = 25000,
                               rngSeed = 540871,
                               showProgress = FALSE)
analysis <- defuse3.alt3$analyze(result)
print(defuse3.alt3$summary(analysis))
```
## The ALT4 Scenario

```{r}
defuse3.alt4 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt4,
                                  showProgress = FALSE)
print(defuse3.alt4)
```

```{r}
result <- defuse3.alt4$explore(numberOfSimulations = 25000,
                               rngSeed = 171053,
                               showProgress = FALSE)
analysis <- defuse3.alt4$analyze(result)
print(defuse3.alt4$summary(analysis))
```
## The ALT5 Scenario

```{r}
defuse3.alt5 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt5,
                                  showProgress = FALSE)
print(defuse3.alt5)
```

```{r}
result <- defuse3.alt5$explore(numberOfSimulations = 25000,
                               rngSeed = 785602,
                               showProgress = FALSE)
analysis <- defuse3.alt5$analyze(result)
print(defuse3.alt5$summary(analysis))
```
## The ALT6 Scenario

```{r}
defuse3.alt6 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt6,
                                  showProgress = FALSE)
print(defuse3.alt6)
```

```{r}
result <- defuse3.alt6$explore(numberOfSimulations = 25000,
                               rngSeed = 457211,
                               showProgress = FALSE)
analysis <- defuse3.alt6$analyze(result)
print(defuse3.alt6$summary(analysis))
```
## The ALT7 Scenario

```{r}
defuse3.alt7 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt7,
                                  showProgress = FALSE)
print(defuse3.alt7)
```

```{r}
result <- defuse3.alt7$explore(numberOfSimulations = 25000,
                               rngSeed = 96196,
                               showProgress = FALSE)
analysis <- defuse3.alt7$analyze(result)
print(defuse3.alt7$summary(analysis))
```
## The ALT8 Scenario

```{r}
defuse3.alt8 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt8,
                                  showProgress = FALSE)
print(defuse3.alt8)
```

```{r}
result <- defuse3.alt8$explore(numberOfSimulations = 25000,
                               rngSeed = 878164,
                               showProgress = FALSE)
analysis <- defuse3.alt8$analyze(result)
print(defuse3.alt8$summary(analysis))
```
## The ALT9 Scenario

```{r}
defuse3.alt9 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt9,
                                  showProgress = FALSE)
print(defuse3.alt9)
```

```{r}
result <- defuse3.alt9$explore(numberOfSimulations = 25000,
                               rngSeed = 589876,
                               showProgress = FALSE)
analysis <- defuse3.alt9$analyze(result)
print(defuse3.alt9$summary(analysis))
```
## The ALT10 Scenario

```{r}
defuse3.alt10 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt10,
                                  showProgress = FALSE)
print(defuse3.alt10)
```

```{r}
result <- defuse3.alt10$explore(numberOfSimulations = 25000,
                               rngSeed = 317454,
                               showProgress = FALSE)
analysis <- defuse3.alt10$analyze(result)
print(defuse3.alt10$summary(analysis))
```
## The ALT11 Scenario

```{r}
defuse3.alt11 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt11,
                                  showProgress = FALSE)
print(defuse3.alt11)
```

```{r}
result <- defuse3.alt11$explore(numberOfSimulations = 25000,
                               rngSeed = 313734,
                               showProgress = FALSE)
analysis <- defuse3.alt11$analyze(result)
print(defuse3.alt11$summary(analysis))
```
## The ALT12 Scenario

```{r}
defuse3.alt12 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt12,
                                  showProgress = FALSE)
print(defuse3.alt12)
```

```{r}
result <- defuse3.alt12$explore(numberOfSimulations = 25000,
                               rngSeed = 304517,
                               showProgress = FALSE)
analysis <- defuse3.alt12$analyze(result)
print(defuse3.alt12$summary(analysis))
```
## The ALT13 Scenario

```{r}
defuse3.alt13 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt13,
                                  showProgress = FALSE)
print(defuse3.alt13)
```

```{r}
result <- defuse3.alt13$explore(numberOfSimulations = 25000,
                               rngSeed = 197549,
                               showProgress = FALSE)
analysis <- defuse3.alt13$analyze(result)
print(defuse3.alt13$summary(analysis))
```
## The ALT14 Scenario

```{r}
defuse3.alt14 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt14,
                                  showProgress = FALSE)
print(defuse3.alt14)
```

```{r}
result <- defuse3.alt14$explore(numberOfSimulations = 25000,
                               rngSeed = 240317,
                               showProgress = FALSE)
analysis <- defuse3.alt14$analyze(result)
print(defuse3.alt14$summary(analysis))
```
## The ALT15 Scenario

```{r}
defuse3.alt15 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt15,
                                  showProgress = FALSE)
print(defuse3.alt15)
```

```{r}
result <- defuse3.alt15$explore(numberOfSimulations = 25000,
                               rngSeed = 977967,
                               showProgress = FALSE)
analysis <- defuse3.alt15$analyze(result)
print(defuse3.alt15$summary(analysis))
```
## The ALT16 Scenario

```{r}
defuse3.alt16 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt16,
                                  showProgress = FALSE)
print(defuse3.alt16)
```

```{r}
result <- defuse3.alt16$explore(numberOfSimulations = 25000,
                               rngSeed = 598879,
                               showProgress = FALSE)
analysis <- defuse3.alt16$analyze(result)
print(defuse3.alt16$summary(analysis))
```
## The ALT17 Scenario

```{r}
defuse3.alt17 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt17,
                                  showProgress = FALSE)
print(defuse3.alt17)
```

```{r}
result <- defuse3.alt17$explore(numberOfSimulations = 25000,
                               rngSeed = 407076,
                               showProgress = FALSE)
analysis <- defuse3.alt17$analyze(result)
print(defuse3.alt17$summary(analysis))
```
## The ALT18 Scenario

```{r}
defuse3.alt18 <- DEFUSE3Design$new(trialParameters = trialParameters,
                                  numberOfSimulations = 25000,
                                  discreteData = TRUE,
                                  designParameters = designParameters$alt18,
                                  showProgress = FALSE)
print(defuse3.alt18)
```

```{r}
result <- defuse3.alt18$explore(numberOfSimulations = 25000,
                               rngSeed = 986017,
                               showProgress = FALSE)
analysis <- defuse3.alt18$analyze(result)
print(defuse3.alt18$summary(analysis))
```

